<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flights Member Tracker (Firebase Edition)</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Flights Member Tracker</h1>
    <!-- Flight Tab Navigation -->
    <div id="flight-tab-nav" class="flight-tab-nav">
        <!-- Dynamically populated flight tabs -->
    </div>
    <!-- Sub-Tab Navigation (Team Overview / Supervision) -->
    <div class="tab-nav" id="sub-tab-nav">
        <button class="tab-btn active" data-tab="team-overview">Team Overview</button>
        <button class="tab-btn" data-tab="supervision-view">Supervision</button>
    </div>
    <!-- Main Content Area -->
    <main id="main-content">
        <div id="team-overview" class="tab-content active team-view-cards">
            <div class="header-controls">
                <button id="add-member-btn">Add New Member</button>
                <button id="manage-fields-btn">Manage Fields</button>
            </div>
            <h2 class="section-header">Inbound</h2>
            <div id="inbound-container" class="team-container"></div>
            <h2 class="section-header">Flight Leads</h2>
            <div id="flight-leads-container" class="team-container"></div>
            <div class="dual-team-container">
                <div>
                    <h2 class="section-header">BRASS</h2>
                    <div id="brass-container" class="team-container"></div>
                </div>
                <div>
                    <h2 class="section-header">SBIRS</h2>
                    <div id="sbirs-container" class="team-container"></div>
                </div>
            </div>
        </div>
        <div id="supervision-view" class="tab-content">
            <!-- This div will be populated by JavaScript -->
        </div>
        <div id="unbilleted-view" class="tab-content">
            <!-- Populated by JavaScript -->
        </div>
    </main>
    
    <!-- ===== MODIFIED: Add Member Modal ===== -->
    <div id="add-member-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2 id="modal-title">Add New Member Details</h2>
            <form id="add-member-form">
                <input type="hidden" id="edit-row-id" name="rowId">
                <fieldset>
                    <legend>Member Details</legend>
                    <div class="form-grid">
                        <div><label for="firstName">First Name</label><input type="text" id="firstName" name="firstName"></div>
                        <div><label for="lastName">Last Name</label><input type="text" id="lastName" name="lastName"></div>
                        <div><label for="rank">Rank</label><select id="rank" name="rank">
    <option value="" disabled selected>Select Rank...</option>
    <option value="E-1">Airman Basic (E-1)</option>
    <option value="E-2">Airman (E-2)</option>
    <option value="E-3">Airman First Class (E-3)</option>
    <option value="E-4">Senior Airman (E-4)</option>
    <option value="E-5">Staff Sergeant (E-5)</option>
    <option value="E-6">Technical Sergeant (E-6)</option>
    <option value="E-7">Master Sergeant (E-7)</option>
    <option value="E-8">Senior Master Sergeant (E-8)</option>
    <!-- ADD THIS LINE -->
    <option value="E-9">Chief Master Sergeant (E-9)</option>
    <option value="O-1">Second Lieutenant (O-1)</option>
    <option value="O-2">First Lieutenant (O-2)</option>
    <option value="O-3">Captain (O-3)</option>
    <option value="O-4">Major (O-4)</option>
</select>
</div>
                        <div><label for="dutyTitle">Duty Title</label><select id="dutyTitle" name="dutyTitle"><option value="" disabled selected>Select Duty Title...</option><option value="Infrared Analyst">Infrared Analyst</option><option value="Senior Infrared Analyst">Senior Infrared Analyst</option><option value="Extractions Supervisor">Extractions Supervisor</option><option value="Section Chief">Section Chief</option><option value="Flight Chief">Flight Chief</option><option value="Flight Commander">Flight Commander</option></select></div>
                        <div><label for="hometown">Hometown</label><input type="text" id="hometown" name="hometown"></div>
                        <div><label for="medicalProfile">Medical Profile</label><select id="medicalProfile" name="medicalProfile"><option value="None" selected>None</option><option value="Permanent">Permanent</option></select></div>
                    </div>
                </fieldset>
                
                <!-- ===== NEW: Placeholder for dynamic custom fields ===== -->
                <fieldset id="custom-fields-fieldset">
                    <legend>Custom Data</legend>
                    <div id="custom-fields-container" class="form-grid">
                        <!-- Custom fields will be injected here by JavaScript -->
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Promotion Data</legend>
                    <div class="form-grid">
                        <div><label for="tisDate">Time-in-Service Date</label><input type="date" id="tisDate" name="tisDate"></div>
                        <div><label for="dorDate">Date of Rank</label><input type="date" id="dorDate" name="dorDate"></div>
                    </div>
                </fieldset>
                <fieldset>
                    <legend>Assignment</legend>
                    <div class="form-grid">
                        <div id="flight-select-container">
                            <label for="flight">Flight</label>
                            <select id="flight" name="flight"><option value="">Unbilleted</option></select>
                        </div>
                        <div id="team-select-container">
                            <label for="teamSelect">Team</label>
                            <select id="teamSelect" name="teamSelect"><option value="" disabled selected>Select Team...</option><option value="inbound-container">Inbound</option><option value="flight-leads-container">Flight Leads</option><option value="brass-container">BRASS</option><option value="sbirs-container">SBIRS</option></select>
                        </div>
                        <div id="status-container">
                            <label for="status">Status</label><select id="status" name="status"><option value="" disabled selected>Select Status...</option><option value="In-route">In-route</option><option value="Inprocessing">Inprocessing</option><option value="Warrior Ethos">Warrior Ethos</option><option value="IQT">IQT</option><option value="MQT">MQT</option><option value="OJT">OJT</option><option value="Certified">Certified</option><option value="QCer">QCer</option></select>
                        </div>
                    </div>
                </fieldset>
                <fieldset id="supervisor-fieldset">
                    <legend>Supervisory Data</legend>
                    <div class="form-grid">
                        <div><label for="supervisor">Supervisor</label><select id="supervisor" name="supervisor"><option value="">(None)</option></select></div>
                        <div><label for="supStartDate">Supervisory Start Date</label><input type="date" id="supStartDate" name="supStartDate"></div>
                    </div>
                </fieldset>
                <button type="submit" id="modal-submit-btn">Add Member</button>
            </form>
        </div>
    </div>

    <!-- ===== ENHANCED: Modal for Managing Custom Fields ===== -->
    <div id="manage-fields-modal" class="modal">
        <div class="modal-content modal-content-wide">
            <span class="close-btn">&times;</span>
            <h2>Manage Custom Fields</h2>

            <!-- Access Control Bar -->
            <div id="access-control-bar" class="access-control-bar">
                <label for="current-role-select">Current Role:</label>
                <select id="current-role-select">
                    <option value="admin">Admin</option>
                    <option value="manager">Manager</option>
                    <option value="user">User</option>
                </select>
                <span id="role-description" class="role-description">Full access: create, edit, and delete fields.</span>
            </div>

            <div id="custom-fields-manager">
                <!-- Field Groups Section -->
                <fieldset id="field-groups-fieldset">
                    <legend>Field Groups / Sections</legend>
                    <div id="field-groups-list" class="field-groups-list">
                        <!-- Populated by JS -->
                    </div>
                    <div class="add-group-row" id="add-group-controls">
                        <input type="text" id="new-group-name" placeholder="New group name..." class="inline-input">
                        <button type="button" id="add-group-btn" class="inline-btn">+ Add Group</button>
                    </div>
                </fieldset>

                <!-- Add New Field Form -->
                <fieldset id="add-field-fieldset">
                    <legend>Add New Field</legend>
                    <form id="add-field-form">
                        <div class="form-grid">
                            <div>
                                <label for="new-field-name">Field Name</label>
                                <input type="text" id="new-field-name" placeholder="e.g., 'Favorite Snack'" required>
                            </div>
                            <div>
                                <label for="new-field-type">Field Type</label>
                                <select id="new-field-type">
                                    <option value="text">Text (Single Line)</option>
                                    <option value="textarea">Text (Multi-line)</option>
                                    <option value="number">Number</option>
                                    <option value="date">Date</option>
                                    <option value="dropdown">Dropdown (Single Selection)</option>
                                    <option value="checkbox">Checkbox</option>
                                    <option value="radio">Radio Buttons</option>
                                    <option value="file">File Upload</option>
                                </select>
                            </div>
                            <div>
                                <label for="new-field-group">Group</label>
                                <select id="new-field-group">
                                    <option value="">(No Group)</option>
                                    <!-- Populated by JS -->
                                </select>
                            </div>
                        </div>

                        <!-- Options for dropdown/radio (hidden by default) -->
                        <div id="field-options-section" class="field-config-section" style="display:none;">
                            <label>Options <span class="help-tip" title="Enter each option on a separate line or click Add Option">?</span></label>
                            <div id="field-options-list" class="field-options-list">
                                <input type="text" class="field-option-input" placeholder="Option 1">
                                <input type="text" class="field-option-input" placeholder="Option 2">
                            </div>
                            <button type="button" id="add-option-btn" class="inline-btn-sm">+ Add Option</button>
                        </div>

                        <!-- Validation Rules -->
                        <div class="field-config-section">
                            <h4 class="config-section-title">Validation Rules</h4>
                            <div class="validation-grid">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="new-field-required"> Required Field
                                </label>
                                <div id="validation-text-rules" class="validation-sub" style="display:none;">
                                    <div><label>Min Length</label><input type="number" id="new-field-min-length" min="0" placeholder="0"></div>
                                    <div><label>Max Length</label><input type="number" id="new-field-max-length" min="0" placeholder="None"></div>
                                    <div class="validation-wide"><label>Custom Regex <span class="help-tip" title="Enter a regular expression pattern to validate input, e.g., ^[A-Z].* for uppercase start">?</span></label><input type="text" id="new-field-regex" placeholder="e.g., ^[A-Za-z]+$"></div>
                                    <div class="validation-wide"><label>Regex Error Message</label><input type="text" id="new-field-regex-msg" placeholder="Custom error message if regex fails"></div>
                                </div>
                                <div id="validation-number-rules" class="validation-sub" style="display:none;">
                                    <div><label>Min Value</label><input type="number" id="new-field-min-value" placeholder="None"></div>
                                    <div><label>Max Value</label><input type="number" id="new-field-max-value" placeholder="None"></div>
                                </div>
                                <div id="validation-date-rules" class="validation-sub" style="display:none;">
                                    <div><label>Earliest Date</label><input type="date" id="new-field-min-date"></div>
                                    <div><label>Latest Date</label><input type="date" id="new-field-max-date"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Display Settings -->
                        <div class="field-config-section">
                            <h4 class="config-section-title">Display Settings</h4>
                            <div class="display-settings-grid">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="new-field-show-card" checked> Show on Member Card
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="new-field-visible" checked> Visible to All Roles
                                </label>
                                <div>
                                    <label for="new-field-card-display">Card Display Location</label>
                                    <select id="new-field-card-display">
                                        <option value="main">Main Profile Area</option>
                                        <option value="collapsible">Collapsible Section</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="new-field-help-text">Help Text / Tooltip</label>
                                    <input type="text" id="new-field-help-text" placeholder="Helpful description shown to users">
                                </div>
                            </div>
                        </div>

                        <!-- Dependency Logic -->
                        <div class="field-config-section">
                            <h4 class="config-section-title">Field Dependency <span class="help-tip" title="Only show this field when another field has a specific value">?</span></h4>
                            <div class="dependency-grid">
                                <div>
                                    <label for="new-field-dep-field">Depends on Field</label>
                                    <select id="new-field-dep-field">
                                        <option value="">(None - Always Visible)</option>
                                        <!-- Populated by JS -->
                                    </select>
                                </div>
                                <div>
                                    <label for="new-field-dep-value">Show When Value Is</label>
                                    <input type="text" id="new-field-dep-value" placeholder="Enter value..." disabled>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="add-field-submit-btn">Add Field</button>
                    </form>
                </fieldset>

                <!-- Existing Fields -->
                <fieldset>
                    <legend>Existing Fields</legend>
                    <div id="existing-fields-list">
                        <!-- Populated by JS -->
                    </div>
                </fieldset>
            </div>
        </div>
    </div>
    <div id="detailed-view-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2 id="detail-modal-title">Member Details</h2>
            <div id="detailed-view-content">
                <!-- Detailed member info will be populated here by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Custom Dialog Modal (replaces browser prompt/alert/confirm) -->
    <div id="custom-dialog-overlay" class="custom-dialog-overlay">
        <div class="custom-dialog">
            <h3 id="custom-dialog-title" class="custom-dialog-title"></h3>
            <p id="custom-dialog-message" class="custom-dialog-message"></p>
            <input type="text" id="custom-dialog-input" class="custom-dialog-input" style="display:none;">
            <div class="custom-dialog-buttons">
                <button id="custom-dialog-cancel" class="custom-dialog-btn custom-dialog-btn-cancel" style="display:none;">Cancel</button>
                <button id="custom-dialog-ok" class="custom-dialog-btn custom-dialog-btn-ok">OK</button>
            </div>
        </div>
    </div>

    <!-- ===== CORRECTED SCRIPT LOADING ===== -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="script.js"></script>
</body>
</html>
